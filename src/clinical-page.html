<html>
    <head>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link href="./wetflag.css" rel="stylesheet">
    </head>
    <body>
        <div class="container-fluid">
            <div id="timer-bar" class="row">
                <div class="col-md-6">
                    Age <span id="age">unknown</span>
                </div>
                <div class="col-md-3">
                    <span id="time">00:00:00</span>
                    <!--<div class="stopwatch"></div>-->
                </div>
                <div class="col-md-3">

                    <button class="btn btn-primary" id="timer-start" onClick="stopwatch.start();">Start</button>
                    <button class="btn btn-primary" id="timer-stop"  onClick="stopwatch.stop();">Stop</button>
                    <button class="btn btn-primary" id="timer-reset" onClick="stopwatch.restart();">Reset</button>
                </div>
             </div>
            <div class="row">
                <div class="col-md-5">
                        <div class="row step">
                            <div class="col-md-6">Weight</div>
                            <div class="col-md-5">
                                <span id="weight">x</span> Kg
                            </div>
                        </div>
                        <div class="row step">
                            <div class="col-md-6">Energy</div>
                            <div class="col-md-6"><span id="energy">x</span> J</div>
                        </div>
                        <div class="row step">
                            <div class="col-md-6">Tube</div>
                            <div class="col-md-6"><span id="tube">x</span> mm</div>
                        </div>
                        <div class="row step">
                            <div class="col-md-6">Fluids</div>
                            <div class="col-md-6"><span id="fluids">x</span> mls</div>
                        </div>
                        <div class="row step">
                            <div class="col-md-6">Lorazepam</div>
                            <div class="col-md-6"><span id="lorazepam">x</span> mg</div>
                        </div>
                        <div class="row step">
                            <div class="col-md-6">Adrenaline</div>
                            <div class="col-md-6"><span id="adrenaline">x</span> ml</div>
                        </div>
                        <div class="row step">
                            <div class="col-md-6">Glucose</div>
                            <div class="col-md-6"><span id="glucose">x</span> ml</div>
                        </div>
                </div>
                <div class="col-md-7">
                    <object data="../SPARCsplit/00000g-wetflag.pdf" type="application/pdf" width="100%" height="100%" id="carepdf">
                        <p> <a href="../SPARCsplit/00000g-wetflag.pdf">Care PDF</a></p>
                    </object>
                </div>
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-1.12.4.min.js"   integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="   crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="timer.jquery.min.js"></script>
        <!--<script src="timer2.js"></script>-->
        <script src="../WetflagCalculations.js"></script>

        <script>
                // Taken on 01/10/2016 from
                // http://stackoverflow.com/questions/19491336/get-url-parameter-jquery-or-how-to-get-query-string-values-in-js

                var getUrlParameter = function getUrlParameter(sParam) {
                    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                        sURLVariables = sPageURL.split('&'),
                        sParameterName,
                        i;

                    for (i = 0; i < sURLVariables.length; i++) {
                        sParameterName = sURLVariables[i].split('=');

                        if (sParameterName[0] === sParam) {
                            return sParameterName[1] === undefined ? true : sParameterName[1];
                        }
                    }
                };

                var url_age = getUrlParameter('age');
                var url_weight = getUrlParameter('weight');

                if (url_age)
                {
                    $('#age').text(url_age);
                }
                else
                {
                     $('#age').text(2);
                }

                if (url_weight)
                {
                    $('#weight').text(url_weight);
                }
                else
                {
                    $('#weight').text(5);
                }

            $('#energy').text("3");
            $('#tube').text("4");
            $('#fluids').text("5");
            $('#lorazepam').text("6");
            $('#adrenaline').text("7");
            $('#glucose').text("8");


            $('#timer-start').click(function(){
                $('#time').timer({
                format: '%H:%M:%S'  //Display time as 00:00:00
                });
            });

            $('#timer-stop').click(function(){
                $('#time').timer('pause');
            });


            function changeData(newURL) {
                if(!document.getElementById("carepdf")) 
                    return false;
                document.getElementById("carepdf").setAttribute('data', newURL);
            }

            function closest(num, arr){
                var current = arr[0]
                for (i = 1; i < arr.length; i++) {
                    var val = arr[i];
                    var currdiff = Math.abs(num - current);
                    var valdiff = Math.abs(num-val);
                    if ( valdiff < currdiff){
                        current = val;
                    }
                }
                return current;
            }

            var weight = document.getElementById("weight").textContent;

            var weightcategories =  [ "00000", "03500", "05000", "07500", "10000", "15000", "20000", "25000", "30000", "35000", "40000", "45000"];

            var chosenweight = closest(weight*1000, weightcategories);

            var newURL = "../SPARCsplit/"+ chosenweight + "g-wetflag.pdf";

            updateWETFLAG();

            window.onload(changeData(newURL));
        </script>
    </body>
</html>
